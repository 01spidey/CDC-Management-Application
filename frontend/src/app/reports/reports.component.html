<div class="main">

    <img (click) = "back()" src="../../assets/back.png" *ngIf="section==2" class="back">

    <div class="top">
        <div class="title" *ngIf="section==1">
            <h1>Reports Dashboard</h1>
            <hr id="line" style="width: 420px;">
        </div>

        <div class="title" *ngIf="section==2">
            <h1>{{action==='add'?'Add Report' : 'Edit Report'}}</h1>
            <hr id="line" style="width: 270px;">
        </div>

        <div *ngIf="section==1 && role=='Officer'" class="add-drive" (click)="changeSection(2)">
            <span class="material-symbols-outlined">
                add_box
            </span>
            <p>Add Report</p>
        </div>
    </div>
    
    <div class="filter-box" *ngIf="section==1">
        <div class="container">
            <div class="filter-container">

                <div class="temp-container">
                    <p style="color:#35363a">Category</p>
                    <div class="status-filter">
                    
                        <a style="text-decoration: none;">
                            <div class="status" [ngClass]="{'active-chip-orange' : report_filter=='All', 'not-active-chip':report_filter!='All'}" (click)="changeFilter('report', 'All')">
                                <span class="material-symbols-outlined">
                                    done
                                </span>
                                <p>All Reports</p>
                            </div>
                        </a>
                        
                        <a style="text-decoration: none;">
                            <div class="status" [ngClass]="{'active-chip-orange' : report_filter=='My', 'not-active-chip':report_filter!='My'}" (click)="changeFilter('report', 'My')">
                                <span class="material-symbols-outlined">
                                    done
                                </span>
                                <p>My Reports</p>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="temp-container">
                    <p>Period</p>
                    <div class="status-filter">
                        
                        <a style="text-decoration: none;">
                            <div class="status" [ngClass]="{'active-chip-blue' : period_filter=='Today', 'not-active-chip':period_filter!='Today'}" (click)="changeFilter('period', 'Today')">
                                <span class="material-symbols-outlined">
                                    done
                                </span>
                                <p>Today</p>
                            </div>
                        </a>

                        <a style="text-decoration: none;">
                            <div class="status" [ngClass]="{'active-chip-blue' : period_filter=='Custom', 'not-active-chip':period_filter!='Custom'}" (click)="changeFilter('period', 'Custom')">
                                <span class="material-symbols-outlined">
                                    done
                                </span>
                                <p>Custom</p>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="temp-container" *ngIf="report_filter==='My'">
                    <p>Visibility</p>
                    <div class="status-filter">
                        <a style="text-decoration: none;">
                            <div class="status" [ngClass]="{'active-chip-dark' : visibility==='All', 'not-active-chip':visibility!='All'}" (click)="changeFilter('vis', 'All')">
                                <span class="material-symbols-outlined">
                                    done
                                </span>
                                <p>All</p>
                            </div>
                        </a>
                        
                        <a style="text-decoration: none;">
                            <div class="status" [ngClass]="{'active-chip-dark' : visibility==='Private', 'not-active-chip':visibility!=='Private'}" (click)="changeFilter('vis', 'Private')">
                                <span class="material-symbols-outlined">
                                    done
                                </span>
                                <p>Private</p>
                            </div>
                        </a>
                    </div>
                </div>
    
            </div>
 
            <a>
                <span matTooltip="Refresh" class="material-symbols-outlined" id="refresh" (click)="applyFilter()">
                    refresh
                </span>
            </a>
            
        </div>
        
        <div class="date-filter" *ngIf="period_filter==='Custom'">
            
            <mat-form-field>
                <mat-label>Filter By Date Range</mat-label>
                
                <mat-date-range-input [rangePicker]="picker">
                  <input matStartDate placeholder="Start date" [(ngModel)]="startDate">
                  <input matEndDate placeholder="End date" [(ngModel)]="endDate">
                </mat-date-range-input>

                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
            <button mat-raised-button (click)="applyFilter()">Apply</button>
        </div>
    </div>

    <div class="no-data" *ngIf="row_data.length==0 && section==1">
        <img src="../../assets/no-data.svg" alt="no-data.svg">
        <p>No Data Found...</p>
    </div>


    <div class="grid-container" *ngIf="section==1">
        <button id="csv-export" (click)="onBtnExport()">
            <span class="material-symbols-outlined">
                download
            </span>
            Export as CSV
        </button>
        <ag-grid-angular
            style="width: 100%; height: 500px;"
            class="ag-theme-alpine"
            [rowData]="row_data"
            [columnDefs]="col_defs"
            [defaultColDef]="defaultColDef"
            [enableRangeSelection]="true"
            (gridReady)="onGridReady($event)"
            ></ag-grid-angular>

        
        <!-- <table *ngIf="section==1 && row_data.length>0">
            <tr>
                <th>Position</th>
                <th>Date</th>
                <th>Staff_ID</th>
                <th>Company</th>
                <th>HR_Name</th>
                <th>HR_mail</th>
                <th>Message</th>
                <th>Contact Mode</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
            <tr *ngFor="let report of row_data">
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}" >{{report.position}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.date}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.staff_id}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.company}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.HR_name}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.HR_mail}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.message}}</td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">{{report.contact_mode}}</td>
                
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}">
                    <span matTooltip="Edit" class="material-symbols-outlined edit" (click)="editReport(report.pk)" *ngIf="report.staff_id===userData.staff_id">
                        edit
                    </span>
                </td>
                <td [ngClass]="{'dark-cell': report.visibility==='Private', 'normal-cell' : report.visibility==='Public'}" >
                    <span matTooltip="Delete" class="material-symbols-outlined delete" *ngIf="report.staff_id===userData.staff_id" (click)="deleteReport(report.pk)">
                        delete
                    </span>
                </td>
            </tr>
        </table> -->
    </div>



    <div class="add-report-box" *ngIf="section==2" [ngStyle]="vis_toggle==='Private'? {'background-color' : '#35363a'} : {}">

        <mat-slide-toggle class="vis-toggle" color="accent"
        (click) = "vis_toggle= vis_toggle==='Public'?'Private' : 'Public'"
        [ngStyle]="vis_toggle==='Private'? {'background-color' : 'white'} : {'background-color' : '#35363a'}" [(ngModel)]="vis_toggle_data">
        
            <div class="toggle-txt" [ngStyle]="vis_toggle==='Private'? {'color' : '#35363a'} : {'color' : 'white'}">
                <span class="material-symbols-outlined" *ngIf="vis_toggle==='Public'">
                    lock_open
                </span>
    
                <span class="material-symbols-outlined" *ngIf="vis_toggle==='Private'">
                    lock
                </span>
    
                <p> {{vis_toggle}} </p>
            </div>
            
        </mat-slide-toggle>

        <form [formGroup]="addReportForm" *ngIf="section==2" [ngStyle]="vis_toggle==='Private'? {'color' : 'white'} : {}">

            <div class="section">
                <div class="input">
                    <p>Company</p>
                    <mat-form-field class="input">
                        <mat-label>e.g. AutoDesk</mat-label>
                        <input matInput formControlName = "company">
                    </mat-form-field>
                </div>

                <div class="input">
                    <p>Contact Mode</p>
                    <mat-form-field>
                        <mat-label>e.g. Mail</mat-label>
                        <input matInput formControlName = "mode">
                    </mat-form-field>
                </div>

            </div>
            
            <div class="section">
                <div class="input">
                    <p>Date</p>
                    <mat-form-field>
                        <mat-label>Choose a date</mat-label>
                        <input matInput [matDatepicker]="picker_1" formControlName = "date">
                        <mat-datepicker-toggle matIconSuffix [for]="picker_1"></mat-datepicker-toggle>
                        <mat-datepicker #picker_1></mat-datepicker>
                      </mat-form-field>
                </div> 

                <div class="input">
                    <div class="reminder-toggle">
                      <p>Reminder</p>
                      <mat-slide-toggle [(ngModel)]="reminder" [ngModelOptions]="{standalone: true}" name="reminderToggle"></mat-slide-toggle>
                    </div>
                    <mat-form-field>
                      <mat-label>Choose a date</mat-label>
                      <input matInput [matDatepicker]="picker_2" [disabled]='!reminder' 
                      [(ngModel)]="reminder_date" [ngModelOptions]="{standalone: true}">
                  
                      <mat-datepicker-toggle matIconSuffix [for]="picker_2"></mat-datepicker-toggle>
                      <mat-datepicker #picker_2></mat-datepicker>
                    </mat-form-field>
                </div>
                  
            </div>
        

            <div class="section">
                <div class="input">
                    <p>HR Name</p>
                    <mat-form-field>
                        <mat-label>e.g. Tom H</mat-label>
                        <input matInput formControlName = "hr_name">
                    </mat-form-field> 
                </div>
    
                <div class="input">
                    <p>HR Mail</p>
                    <mat-form-field>
                        <mat-label>e.g. TomH@amazon.com*</mat-label>
                        <input matInput formControlName = "hr_mail">
                    </mat-form-field> 
                </div>
            </div>
            
            <div class="input">
                <p>Message</p>
                <mat-form-field>
                    <mat-label>Write Your Message Here</mat-label>
                    <textarea matInput formControlName="message"></textarea>
                </mat-form-field> 
            </div>

            <div class="input" *ngIf="vis_toggle==='Private'">
                <p>Visible To</p>
                <mat-form-field class="example-chip-list">
                    <mat-label>Add Members</mat-label>
                    <mat-chip-grid #chipGrid aria-label="Enter members">
                      <mat-chip-row *ngFor="let member of member_lst"
                                    (removed)="remove(member)"
                                    [editable]="true"
                                    (edited)="edit(member, $event)"
                                    [aria-description]="'press enter to edit ' + member">
                        {{member}}
                        <button matChipRemove [attr.aria-label]="'remove ' + member">
                          <mat-icon>cancel</mat-icon>
                        </button>
                      </mat-chip-row>
                      <input placeholder="New Member..."
                             [matChipInputFor]="chipGrid"
                             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                             [matChipInputAddOnBlur]="addOnBlur"
                             (matChipInputTokenEnd)="add($event)"/>
                    </mat-chip-grid>
                  </mat-form-field>
            </div>
                         

            <div class="btns">
              <button mat-raised-button id="reset" (click)="resetForm()">Reset</button>
              <button mat-raised-button id="add" (click) = "action==='add'?addReport() :updateReport()">{{action==='add'?'Add Report' : 'Save Changes'}}</button>
            </div>
          
        </form>

    </div>


</div>